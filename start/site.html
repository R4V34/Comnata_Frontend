<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Comnata</title>
	<link rel="stylesheet" href="main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body bgcolor="#262c38">
    <div id="main_area">
	    <div id="mid_text">ИЛИ</div>
        <div class="input__wrapper">
            <form action="/video/upload" enctype="multipart/form-data" method="post">
                <input type="file" id="input__file" hidden onchange="downloadFile()" accept=".mp4">
                <input type="submit" hid>
            </form>
            <div id="button_load">
                <div id="button_load_text">Выберите файл</div>
                <label for="input__file" id="download_label"></label>
            </div>
        </div>
        <button id="start_button" onclick="tryStartRoom()">Создать комнату</button>
	    <input id="textarea" placeholder="Введите ссылку..." rows="1"></input>
        <div id="line_"></div>
	</div>
    <h1 id="bottom_text">COMNATA</h1>


	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@500&family=Montserrat:wght@600&display=swap" rel="stylesheet">

	<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>
	

    <!-- button_.innerHTML -->
	<script type="text/javascript">
            function downloadFile()
            {
                var input = document.getElementById("input__file");
                var textarea = document.getElementById("textarea");
                if (input.files.length > 0)
                    textarea.value = input.files[0].name;
            }

            function tryStartRoom()
            {
                var button_ = document.getElementById("button_load");
                var link = document.getElementById("textarea").value;
                var input = document.getElementById("input__file");
                var textarea = document.getElementById("textarea");
                if (link.indexOf("youtube.com/watch") != -1){
                    localStorage.setItem('comnata_link_youtube', rightLink('v=', link));
                    document.location = '../youtube_player/site.html';
                }
                else if (link.indexOf("https://www.youtube.com/embed") == 0){
                    localStorage.setItem('comnata_link_youtube', link);
                    document.location = '../youtube_player/site.html';
                }
                else if (link.indexOf("youtu.be") != -1){
                    localStorage.setItem('comnata_link_youtube', rightLink('e/', link));
                    document.location = '../youtube_player/site.html';
                }
                else if (input.files.length > 0)
                {
                    var formData = new FormData();
                    formData.set("video", input.files[0]);
                    
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "https://8962cea9de76.ngrok.io/video/upload");
                    xhr.send(formData);
                }
            }

            function rightLink(e, link)
            {
            	link = link + '&';
            	var n = link.indexOf(e) + e.length;
            	var rigth_link = '';
            	while (link.charAt(n) != '&')
            	{
            		rigth_link = rigth_link + link.charAt(n);
            		n += 1;
            	}
            	return 'https://www.youtube.com/embed/' + rigth_link;
            }
    </script>
</body>
</html>